# coding=utf-8

sources = [
            # Вести
            {
                # Основные данные по новостному ресурсу
                'enabled': True,                    # Флаг управления. Определяет будет ли этот источник использоваться при краулинге
                'name': 'Вести',                    # Название источника. Эта строчка попадет в базу данных в ноду Source, именно по ней проходит поиск
                'url': 'http://www.vesti.ru',       # Доменное имя источника. Без завершающего слеша
                'test_urls': ['http://www.vesti.ru/doc.html?id=2878282'],   # Одна или более ссылок для проверки работы конфига на данном источнике
                'yandex_news_id': 1102,             # ID источника в сервисе Яндекс.Новостей
                '''
                Как найти ID источника в Яндекс.Новостях?
                Нужно зайти в фильтр https://news.yandex.ru/advanced.html?text=. Там в длинном списке источников нужно
                найти нужный (можно использовать Ctrl+F на странице), выбрать его и нажать «Найти». После этого в урле
                будет такой параметр: nsrc=9602. Вот 9602 и есть ID источника в Яндекс.Новостях
                '''

                'refresh_delay': 600,               # Частота проверки главной страницы источника (используется в соответствующем модуле)

                'detailed_page_re': '/doc.html\?id=[0-9]{7}',
                '''
                Шаблон url для новостной страницы. Представляет собой регулярное выражение, по которому будут
                находиться ссылки на новостные страницы. Шаблон нужно делать как можно более точным (в разумных пределах),
                чтобы избежать ошибочных совпадений.

                Про регулярные выражения можно почитать тут: https://docs.python.org/2/library/re.html

                Вот наиболее часто встречающиеся варианты:
                любой символ не являющийся спецсимолом - соответствует себе самому
                . (просто точка) - соответствует любому символу
                \ - экранирует следующий за ним спецсимвол
                + - предыдущий шаблон повторяется 1 или более раз; например, шаблон a+ будет соответствовать строкам
                из букв "a" любой длины
                [] - любой символ из набора в скобках; например, шаблон [abc] будет соответствовать стокам "a",
                "b" или "c", а шаблон [ab]+ будет соответствовать любой строке, состоящий из символов "a" или "b"
                в любом порядке и в любом количестве
                - (дефис) - задает интервал символов; например, шаблон [0-9] соответствует любой цифре от 0 до 9,
                а шаблон [0-9]+ - вообще любому числу; интервал можно задавать и для симовлов, например, [a-z]
                соответствует любому символу латинского алфавита в нижнем регистре
                \w - соответтвует любой букве
                {} - задает количество повторений для шаблона; напрмер [0-9]{4} будет соответствовать любому
                четырехзначному числу

                Другие примеры этого параметра:
                'detailed_page_re': '/news/[0-9]{4}/[0-9]{1,2}/[0-9]{1,2}/[-\w]+'   - Медуза
                'detailed_page_re': '/news/[0-9]{4}/[0-9]{1,2}/[0-9]{1,2}/[_\w]+'   - Лента
                'detailed_page_re': '/[_\w]+/[0-9]{2}/[0-9]{2}/[0-9]{4}/[\w0-9]+'   - РБК
                'detailed_page_re': '/[_\w0-9]+/[0-9]{8}/[0-9]+\.html'              - РИА
                'detailed_page_re': '/[0-9]{4}/[0-9]{2}/[0-9]{2}/[0-9]{3}/'         - Фонтанка
                '''

                # Дальше лежат данные по аттрибутам для извлечения
                'attributes_text': {
                    'title': '//h3[@class="article__title"]',
                    'text': '//div[@class="article__text"]//p',
                },
                'attributes_relations': {
                    'date': '//div[@class="article__date"]/text()[1]',
                    # 'tag': 'xpath',
                    # 'region': 'xpath',
                },
                '''
                Параметры attributes_text и attributes_relations задают аттрибуты для извлечения.

                Сначала о различии между ними
                Аттрибуты записанные в первом словаре могут быть заданы произвольно (title, text или любой другой).
                При извлечении эти аттрибуты будут записаны в ноду самой новости как ее аттрибуты в сериализованном
                виде. Соответственно, по ним будет невозможен быстрый поиск и фильтрация средствами СУБД.
                В противоположность, для аттрибутов из второго словаря будут созданы собственные ноды, которые будут
                связанны с нодами новостей отношениями (ребрами графа). По этим аттрибутам уже будет можно проводить
                фильтрацию средствами СУБД. Но эти аттрибуты не могут быть заданы произвольно. В настоящий момент
                доступны только три варианта: date, tag и region

                Теперь о содержании
                Путь для извлечения аттрибутов со страниц новостей задается с помощью xpath

                Вот наиболее часто встречающиеся варианты:
                / - прямой потомок
                // - непрямой потомок
                Например //div найдет все теги div на странице, //div/p найдет все теги p, которые являются
                непосредственным потомком любого тега div
                Чтобы ограницить выбор тегов одного типа следует использовать классы. Для классов есть 2 основных
                варианта: div[@class="someclass"] и div[contains(@class, "someclass")]. Отличаются они тем, что
                в первом случае будут выбраны только дивы с единственным этим классом, а второй вариант даст совпадение,
                если указанный класс является одним из нескольких, указанных для данного тега
                @href - конструкция, начинающаяся с символа @ извлечет не содержимое тега, а указанный параметр

                Другие примеры этих параметров:
                Медуза:
                'attributes_text': {
                    'title': '//h1[@class="NewsMaterialHeader-title"]',
                    'text': '//div[@class="Body"]//p',
                },
                'attributes_relations': {
                    'date': '//div[contains(@class, "MaterialMeta--time")]',
                },

                Лента:
                'attributes_text': {
                    'title': '//h1[@class="b-topic__title"]',
                    'text': '//div[contains(@class, "b-text")]//p',
                },
                'attributes_relations': {
                    'date': '//div[@class="b-topic__info"]/time[@class="g-date"]',
                },

                РБК
                'attributes_text': {
                    'title': '//div[contains(@class, "article__header__title")]',
                    'text': '//div[contains(@class, "article__content")]/p',
                },
                'attributes_relations': {
                    'date': '//span[@class="article__header__date"]',
                },

                РИА
                'attributes_text': {
                    'title': '//h1[@class="b-article__title"]/span',
                    'text': '//div[contains(@class, "b-article__body")]/p',
                },
                'attributes_relations': {
                    'date': '//div[@class="b-article__info-date"]/span[2]',
                    'tag': '//ul[@class="b-article__tags-list"]/li/a/span',
                },

                Фонтанка
                'attributes_text': {
                    'title': '//div[@class="article_title"]',
                    'text': '//div[@class="article_fulltext"]/p',
                },
                'attributes_relations': {
                    'date': '//div[contains(@class, "article_date")]',
                },
                '''

                'related': '//div[@class="more-news"]/ul/li/h4/a/@href',
                '''
                Последний доступный параметр related аналогичен двум предыдущим, т.е. служит для извлечения данных
                со страниц и задается с помощью xpath, но он извлекает ссылки на "связанные" новости с данной. То
                есть, если на сайте источника есть специальный блок для новостей по той же теме, но можно указать этот
                параметр, и тогда новости будут связаны в базе данных отношениями

                Другие примеры этого параметра:
                'related': '//div[@class="Related"]/ul/li/a/@href' - Медуза
                'related': '//section[contains(@class, "b-topic-addition")]/div[@class="item"]//a/@href' - Лента
                'related': '//div[@class="b-inject__article-title"]/a/@href' - РИА
                'related': '//div[@class="center_article"]/div[@class="widget"]//div[@class="entry_title"]/a/@href' - Фонтанка
                '''
            },
]
